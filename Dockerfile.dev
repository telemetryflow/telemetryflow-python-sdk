# =============================================================================
# TelemetryFlow Python SDK - Development Dockerfile
# =============================================================================
#
# TelemetryFlow Python SDK - Community Enterprise Observability Platform (CEOP)
# Copyright (c) 2024-2026 DevOpsCorner Indonesia. All rights reserved.
#
# This Dockerfile is optimized for development with hot-reloading,
# debugging tools, and all development dependencies installed.
#
# =============================================================================

FROM python:3.12-slim

# =============================================================================
# TelemetryFlow Metadata Labels (OCI Image Spec)
# =============================================================================
LABEL org.opencontainers.image.title="TelemetryFlow Python SDK - Development" \
      org.opencontainers.image.description="Development image for TelemetryFlow Python SDK" \
      org.opencontainers.image.version="1.1.1-dev" \
      org.opencontainers.image.vendor="TelemetryFlow" \
      org.opencontainers.image.authors="DevOpsCorner Indonesia <support@devopscorner.id>" \
      org.opencontainers.image.licenses="Apache-2.0"

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1 \
    # Development settings
    PYTHONFAULTHANDLER=1 \
    PYTHONHASHSEED=random

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    curl \
    wget \
    vim \
    ca-certificates \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy requirements first for better caching
COPY pyproject.toml README.md LICENSE ./
COPY src/ ./src/

# Install the package with all development dependencies
RUN pip install --upgrade pip && \
    pip install -e ".[dev,http,grpc]"

# Install additional development tools
RUN pip install \
    ipython \
    ipdb \
    watchdog \
    httpx

# Create workspace directory
RUN mkdir -p /workspace

# Set default command
CMD ["python", "-c", "from telemetryflow import TelemetryFlowBuilder; print('TelemetryFlow Python SDK - Development Environment Ready!')"]

# =============================================================================
# Usage:
#   # Build development image
#   docker build -f Dockerfile.dev -t telemetryflow/telemetryflow-python-sdk:dev .
#
#   # Run development container
#   docker run -it --rm -v $(pwd):/app telemetryflow/telemetryflow-python-sdk:dev bash
#
#   # Run tests
#   docker run --rm -v $(pwd):/app telemetryflow/telemetryflow-python-sdk:dev pytest
#
#   # Run with hot-reload (using watchdog)
#   docker run -it --rm -v $(pwd):/app telemetryflow/telemetryflow-python-sdk:dev \
#     watchmedo auto-restart --patterns="*.py" --recursive -- python examples/basic/main.py
# =============================================================================
